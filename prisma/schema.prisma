generator client {
    provider = "prisma-client"
    output   = "../src/generated/prisma"
    runtime  = "deno"
}

datasource db {
    provider = "postgresql"
    url      = env("DATABASE_URL")
}

enum LocationType {
    combat
    event
    elite
    tavern
    treasure
    boss
    campfire
}

model Player {
    id         String  @id
    name       String
    health     Int
    maxHealth  Int     @default(10)
    lastTarget String?

    @@index([lastTarget])
}

model Location {
    id          String       @id
    channelId   String
    row         Int
    col         Int
    name        String
    description String
    attributes  Json
    type        LocationType
    createdAt   DateTime     @default(now())
    updatedAt   DateTime     @updatedAt
    fromPaths   Path[]       @relation("FromLocation")
    toPaths     Path[]       @relation("ToLocation")
    Guild       Guild[]
}

model Path {
    id             String   @id
    channelId      String
    fromLocation   Location @relation("FromLocation", fields: [fromLocationId], references: [id])
    fromLocationId String
    toLocation     Location @relation("ToLocation", fields: [toLocationId], references: [id])
    toLocationId   String
    description    String
    attributes     Json
    createdAt      DateTime @default(now())
    updatedAt      DateTime @updatedAt
}

model Guild {
    guildId           String    @id
    currentLocation   Location? @relation(fields: [currentLocationId], references: [id])
    currentLocationId String?
    updatedAt         DateTime  @updatedAt
    seed              String    @default(uuid())
    randomCursor      Int       @default(0)
}
